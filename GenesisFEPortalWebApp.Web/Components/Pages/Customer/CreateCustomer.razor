@page "/customer/create"
@using GenesisFEPortalWebApp.Models.Entities.Core

<RadzenStack Gap="1rem" Class="rz-p-4">
    <RadzenText TextStyle="TextStyle.H3">Registrar Nuevo Cliente</RadzenText>

    @if (!string.IsNullOrEmpty(identificationError))
    {
        <RadzenAlert AlertStyle="AlertStyle.Danger" ShowIcon="true" Variant="Variant.Flat">
            @identificationError
        </RadzenAlert>
    }

    <RadzenTemplateForm TItem="CustomerModel" Data="@customer" Submit="@HandleValidSubmit">
        <RadzenStack Gap="1rem">
            <!-- Panel de Información de Identificación -->
            <RadzenFieldset Text="Información de Identificación">
                <RadzenRow Class="rz-mb-3">
                    <RadzenColumn Size="12" SizeMD="4">
                        <RadzenFormField Text="Tipo de Identificación" Variant="Variant.Filled">
                            <RadzenDropDown @bind-Value="customer.IdentificationTypeId"
                                            Data="@IdentificationTypes"
                                            TextProperty="Description"
                                            ValueProperty="ID"
                                            Change="@(args => ValidateIdentification())"
                                            Class="w-100" />
                        </RadzenFormField>
                    </RadzenColumn>

                    <RadzenColumn Size="12" SizeMD="4">
                        <RadzenFormField Text="Número de Identificación" Variant="Variant.Filled">
                            <RadzenTextBox @bind-Value="customer.Identification"
                                           Change="@(args => ValidateIdentification())"
                                           Class="w-100" />
                        </RadzenFormField>
                    </RadzenColumn>
                </RadzenRow>
            </RadzenFieldset>

            <!-- Panel de Información General -->
            <RadzenFieldset Text="Información General">
                <RadzenRow Class="rz-mb-3">
                    <RadzenColumn Size="12" SizeMD="6">
                        <RadzenFormField Text="Nombre Cliente" Variant="Variant.Filled">
                            <RadzenTextBox @bind-Value="customer.CustomerName"
                                           Class="w-100" />
                        </RadzenFormField>
                    </RadzenColumn>

                    <RadzenColumn Size="12" SizeMD="6">
                        <RadzenFormField Text="Nombre Comercial" Variant="Variant.Filled">
                            <RadzenTextBox @bind-Value="customer.CommercialName"
                                           Class="w-100" />
                        </RadzenFormField>
                    </RadzenColumn>
                </RadzenRow>

                <RadzenRow Class="rz-mb-3">
                    <RadzenColumn Size="12" SizeMD="6">
                        <RadzenFormField Text="Correo Electrónico" Variant="Variant.Filled">
                            <RadzenTextBox @bind-Value="customer.Email"
                                           Type="email"
                                           Class="w-100" />
                        </RadzenFormField>
                    </RadzenColumn>

                    <RadzenColumn Size="12" SizeMD="6">
                        <RadzenFormField Text="Teléfono" Variant="Variant.Filled">
                            <RadzenRow>
                                <RadzenColumn Size="4">
                                    <RadzenTextBox @bind-Value="customer.PhoneCode"
                                                   Placeholder="Código"
                                                   Class="w-100" />
                                </RadzenColumn>
                                <RadzenColumn Size="8">
                                    <RadzenTextBox @bind-Value="customer.Phone"
                                                   Placeholder="Número"
                                                   Class="w-100" />
                                </RadzenColumn>
                            </RadzenRow>
                        </RadzenFormField>
                    </RadzenColumn>
                </RadzenRow>
            </RadzenFieldset>

            <!-- Panel de Ubicación -->
            <RadzenFieldset Text="Ubicación">
                <RadzenRow Class="rz-mb-3">
                    <RadzenColumn Size="12" SizeMD="4">
                        <RadzenFormField Text="Provincia" Variant="Variant.Filled">
                            <RadzenDropDown @bind-Value="ProvinceSelected"
                                            Data="@Provinces"
                                            TextProperty="ProvinceName"
                                            ValueProperty="ProvinceID"
                                            Change="@SearchCantonsOfProvinces"
                                            Class="w-100" />
                        </RadzenFormField>
                    </RadzenColumn>

                    <RadzenColumn Size="12" SizeMD="4">
                        <RadzenFormField Text="Cantón" Variant="Variant.Filled">
                            <RadzenDropDown @bind-Value="CantonSelected"
                                            Data="@Cantons"
                                            TextProperty="CantonName"
                                            ValueProperty="CantonID"
                                            Change="@SearchDistrictsOfCanton"
                                            Class="w-100" />
                        </RadzenFormField>
                    </RadzenColumn>

                    <RadzenColumn Size="12" SizeMD="4">
                        <RadzenFormField Text="Distrito" Variant="Variant.Filled">
                            <RadzenDropDown @bind-Value="customer.DistrictId"
                                            Data="@Districts"
                                            TextProperty="DistrictName"
                                            ValueProperty="DistrictID"
                                            Class="w-100" />
                        </RadzenFormField>
                    </RadzenColumn>
                </RadzenRow>

                <RadzenRow>
                    <RadzenColumn Size="12" SizeMD="6">
                        <RadzenFormField Text="Barrio" Variant="Variant.Filled">
                            <RadzenTextBox @bind-Value="customer.Neighborhood"
                                           Class="w-100" />
                        </RadzenFormField>
                    </RadzenColumn>

                    <RadzenColumn Size="12" SizeMD="6">
                        <RadzenFormField Text="Dirección Exacta" Variant="Variant.Filled">
                            <RadzenTextArea @bind-Value="customer.Address"
                                            Class="w-100"
                                            Rows="3" />
                        </RadzenFormField>
                    </RadzenColumn>
                </RadzenRow>
            </RadzenFieldset>

            <!-- Botones de Acción -->
            <RadzenStack Orientation="Orientation.Horizontal"
                         JustifyContent="JustifyContent.End"
                         Gap="1rem"
                         Class="rz-mt-4">
                <RadzenButton ButtonStyle="ButtonStyle.Light"
                              Click="@(() => NavigationManager.NavigateTo("/customer"))"
                              Text="Cancelar" />
                <RadzenButton ButtonType="ButtonType.Submit"
                              ButtonStyle="ButtonStyle.Primary"
                              Text="Guardar" />
            </RadzenStack>
        </RadzenStack>
    </RadzenTemplateForm>
</RadzenStack>